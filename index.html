<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MasterShop PRO</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#020617;color:white;font-family:tahoma}
.app{display:none}
.sidebar{background:#020617;padding:15px;position:fixed;width:230px;height:100vh}
.sidebar button{width:100%;margin-bottom:10px}
.content{margin-right:240px;padding:20px}
.card-box{background:#0f172a;padding:20px;border-radius:12px;text-align:center;transition:.3s}
.card-box:hover{transform:scale(1.05)}
.box{max-width:420px;margin:60px auto;background:#0f172a;padding:25px;border-radius:15px}
.whatsapp{
position:fixed;bottom:20px;left:20px;
background:#25d366;color:white;
padding:12px 16px;border-radius:50%;
font-size:22px;text-decoration:none;
}
@media(max-width:768px){
.sidebar{position:relative;width:100%;height:auto}
.content{margin-right:0}
}
</style>
</head>
<body>

<a class="whatsapp" target="_blank"
href="https://wa.me/201021157191">ğŸ“</a>

<!-- LOGIN -->
<div id="login" class="box">
<h4 class="text-center">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h4>
<input id="lemail" class="form-control mb-2" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯">
<input id="lpass" type="password" class="form-control mb-2" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
<button class="btn btn-primary w-100" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<p class="text-center mt-3">
<span style="cursor:pointer;color:#0d6efd" onclick="showReg()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</span>
</p>
</div>

<!-- REGISTER -->
<div id="reg" class="box" style="display:none">
<h4 class="text-center">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h4>
<input id="rname" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<input id="rshop" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†">
<input id="remail" class="form-control mb-2" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯">
<input id="rpass" type="password" class="form-control mb-2" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± 1 - 8">
<select id="rtype" class="form-select mb-2">
<option value="admin">Ø£Ø¯Ù…Ù†</option>
<option value="staff">Ù…ÙˆØ¸Ù</option>
</select>
<button class="btn btn-success w-100" onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>
<p class="text-center mt-2">
<span style="cursor:pointer;color:#0d6efd" onclick="showLogin()">Ø±Ø¬ÙˆØ¹</span>
</p>
</div>

<!-- APP -->
<div id="app" class="app">

<div class="sidebar">
<h4>MasterShop</h4>
<button onclick="show('dash')" class="btn btn-dark">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<button id="pbtn" onclick="show('prod')" class="btn btn-dark">Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
<button onclick="show('sales')" class="btn btn-dark">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>
<button id="rbtn" onclick="show('report')" class="btn btn-dark">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
<button onclick="show('set')" class="btn btn-dark">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
<button onclick="logout()" class="btn btn-danger">Ø®Ø±ÙˆØ¬</button>
</div>

<div class="content">

<!-- DASH -->
<div id="dash">
<div class="row g-3">
<div class="col-md-4"><div class="card-box">Ø§Ù„Ø¯Ø®Ù„<br><h3 id="rev">0</h3></div></div>
<div class="col-md-4"><div class="card-box">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª<br><h3 id="scount">0</h3></div></div>
<div class="col-md-4"><div class="card-box">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù<br><h3 id="pcount">0</h3></div></div>
</div>
<canvas id="chart" class="mt-4"></canvas>
</div>

<!-- PRODUCTS -->
<div id="prod" style="display:none">
<h4>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</h4>
<input id="pname" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pprice" class="form-control mb-2" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<input id="pqty" class="form-control mb-2" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<button class="btn btn-success" onclick="add()">Ø¥Ø¶Ø§ÙØ©</button>

<table class="table table-dark mt-3">
<tbody id="ptable"></tbody>
</table>
</div>

<!-- SALES -->
<div id="sales" style="display:none">
<select id="sellp" class="form-select mb-2"></select>
<input id="sellq" class="form-control mb-2" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<button class="btn btn-primary" onclick="sell()">Ø¨ÙŠØ¹</button>
</div>

<!-- REPORT -->
<div id="report" style="display:none">
<h4>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h4>
<p id="rtext"></p>
</div>

<!-- SETTINGS -->
<div id="set" style="display:none">
<h4>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h4>
<p id="utype"></p>
<button class="btn btn-warning" onclick="reset()">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
</div>

</div>
</div>

<script>
let users=JSON.parse(localStorage.users||"[]");
let prods=JSON.parse(localStorage.prods||"[]");
let sales=JSON.parse(localStorage.sales||"[]");
let cur=null;

function showReg(){login.style.display="none";reg.style.display="block"}
function showLogin(){reg.style.display="none";login.style.display="block"}

function register(){
if(rpass.value.length<1||rpass.value.length>8)
return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù…Ù† 1 Ù„Ù€ 8 Ø£Ø­Ø±Ù");

users.push({
name:rname.value,
shop:rshop.value,
email:remail.value,
pass:rpass.value,
type:rtype.value
});
localStorage.users=JSON.stringify(users);
alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨");
showLogin();
}

function login(){
cur=users.find(x=>x.email==lemail.value&&x.pass==lpass.value);
if(!cur)return alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙ„Ø·");

localStorage.cur=JSON.stringify(cur);
login.style.display="none";
app.style.display="block";
checkRole();
load();
}

function checkRole(){
if(cur.type=="staff"){
pbtn.style.display="none";
rbtn.style.display="none";
}
utype.innerHTML="Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨: "+cur.type;
}

function logout(){localStorage.clear();location.reload()}

function show(x){
["dash","prod","sales","report","set"]
.forEach(i=>document.getElementById(i).style.display="none");
document.getElementById(x).style.display="block";
}

function add(){
prods.push({n:pname.value,p:+pprice.value,q:+pqty.value});
localStorage.prods=JSON.stringify(prods);
load();
}

function del(i){
prods.splice(i,1);
localStorage.prods=JSON.stringify(prods);
load();
}

function sell(){
let i=sellp.value,q=+sellq.value;
if(q>prods[i].q)return alert("Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ø´ ÙƒÙØ§ÙŠØ©");
prods[i].q-=q;
sales.push({n:prods[i].n,q});
localStorage.sales=JSON.stringify(sales);
localStorage.prods=JSON.stringify(prods);
load();
}

function reset(){
if(confirm("Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")){
localStorage.clear();
location.reload();
}
}

function load(){
ptable.innerHTML="";
sellp.innerHTML="";
prods.forEach((x,i)=>{
ptable.innerHTML+=`
<tr>
<td>${x.n}</td>
<td>${x.p}</td>
<td>${x.q}</td>
<td><button onclick="del(${i})" class="btn btn-danger btn-sm">Ø­Ø°Ù</button></td>
</tr>`;
sellp.innerHTML+=`<option value=${i}>${x.n}</option>`;
});

rev.innerHTML=sales.reduce((a,b)=>a+b.q*50,0);
scount.innerHTML=sales.length;
pcount.innerHTML=prods.length;

draw();
rtext.innerHTML="Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: "+sales.length;
}

function draw(){
if(window.ch)ch.destroy();
ch=new Chart(chart,{
type:"bar",
data:{
labels:prods.map(x=>x.n),
datasets:[{
label:"Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",
data:prods.map(p=>{
return sales.filter(s=>s.n==p.n)
.reduce((a,b)=>a+b.q,0)
})
}]
}
});
}

if(localStorage.cur){
cur=JSON.parse(localStorage.cur);
login.style.display="none";
app.style.display="block";
checkRole();
load();
}
</script>
</body>
</html>
